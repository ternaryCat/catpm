<% content_for :title, "Ignored Endpoints" %>
<% content_for :subtitle, "Endpoints hidden from the main dashboard" %>

<%= render "catpm/shared/page_nav", active: "performance" %>

<div class="tabs">
  <a href="<%= catpm.status_index_path %>" class="tab">Active (<%= @active_endpoint_count %>)</a>
  <a href="<%= catpm.ignored_endpoints_path %>" class="tab active">Ignored (<%= @ignored_endpoints.size %>)</a>
</div>

<%# ─── Time Range ─── %>
<div class="time-range">
  <% (["all"] + Catpm::ApplicationHelper::RANGE_KEYS).each do |r| %>
    <a href="<%= catpm.ignored_endpoints_path(range: r) %>" class="<%= 'active' if @range == r %>"><%= r == "all" ? "All" : r %></a>
  <% end %>
</div>

<% if @ignored_endpoints.any? %>
  <div class="table-scroll">
  <table>
    <thead>
      <tr>
        <th>Kind</th>
        <th>Target</th>
        <th>Count</th>
        <th>Avg</th>
        <th>Last Seen</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <% @ignored_endpoints.each do |ep| %>
        <% ep_p = { kind: ep[:kind], target: ep[:target], operation: ep[:operation] } %>
        <tr class="linked">
          <td><a href="<%= catpm.endpoint_path(ep_p) %>" class="row-link"><%= type_badge(ep[:kind]) %></a></td>
          <td class="mono"><%= ep[:target] %><%= " #{ep[:operation]}" if ep[:operation].present? %></td>
          <td><%= ep[:total_count] %></td>
          <td class="mono"><%= format_duration(ep[:avg_duration]) %></td>
          <td><%= ep[:last_seen] ? time_with_tooltip(ep[:last_seen]) : "—" %></td>
          <td style="position:relative; z-index:2; width:28px; padding:4px 2px; text-align:center">
            <button class="action-menu-btn">&#x22EE;</button>
            <div class="action-menu">
              <button data-action="unignore" data-url="<%= catpm.endpoint_ignore_path(ep_p) %>">Unignore</button>
              <button class="menu-danger" data-action="delete" data-url="<%= catpm.endpoint_path(ep_p) %>">Delete</button>
            </div>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
  </div>
<% else %>
  <div class="empty-state">
    <div class="empty-title">No ignored endpoints</div>
    <div class="empty-hint">Endpoints you ignore will appear here.</div>
  </div>
<% end %>
